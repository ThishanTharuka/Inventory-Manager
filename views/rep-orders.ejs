<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles.css"> <!-- Create a styles.css file for styling -->
    <link rel="stylesheet" href="/nav.css">
    <title>
        <%= title %>
    </title>
    <link rel="icon" href="/images/invoice.svg" type="image/x-icon">
</head>

<body>
    <!-- Include the navigation partial -->
    <%- include('./partials/nav.ejs') %>
        <div id="top-bar">
            <div id="page-name">
                <p>Rep's Orders</p>
            </div>
            <div id="add-new">
                <!-- Add New Invoice button -->
                <a href="/rep-orders/add" id="add-new-btn">Add New</a>
            </div>
        </div>
        <main>
            <form class="top-bar" action="/rep-orders" method="get">
                <label for="search">Search Order ID:</label>
                <input type="text" id="search" name="search" value="<%= search || '' %>">
                <button id="search-btns" type="submit">Search</button>
                <a href="/rep-orders"><button id="search-btns" type="button">Reset</button></a>
            </form>
            <div class="cards">
                <% if (reps_orders.length> 0) { %>
                    <% reps_orders.forEach((reps_order)=> { %>
                        <div class="invoice-card">
                            <h3>Order ID: <%= reps_order.order_id %>
                            </h3>
                            <p>Order Date: <%= reps_order.order_date.toLocaleDateString('en-GB') %>
                            </p>
                            <table id="invoice-tbl">
                                <thead>
                                    <tr>
                                        <th class="left-align">Item Code</th>
                                        <th class="left-align">Item Name</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% reps_order.items.forEach((item)=> { %>
                                        <tr>
                                            <td class="left-align">
                                                <%= item.item_code %>
                                            </td>
                                            <td class="left-align">
                                                <%= item.description %>
                                            </td>
                                            <td>
                                                <%= item.quantity %>
                                            </td>
                                            <td>
                                                <%= item.price_per_item.toLocaleString(undefined, {
                                                    minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>
                                            </td>
                                            <td>
                                                <%= item.total.toLocaleString(undefined, { minimumFractionDigits: 2,
                                                    maximumFractionDigits: 2 }) %>
                                            </td>
                                        </tr>
                                        <% }); %>
                                            <tr>
                                                <td class="left-align" colspan="4">Total</td>
                                                <td>
                                                    <%= reps_order.full_total.toLocaleString(undefined, {
                                                        minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>
                                                </td>
                                            </tr>
                                </tbody>
                            </table>
                        </div>
                        <% }); %>
                            <% } else { %>
                                <p>No Orders found.</p>
                                <% } %>
            </div>
        </main>
</body>

</html>